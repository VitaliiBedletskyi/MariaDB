var Ne=Object.defineProperty;var a=(o,S)=>Ne(o,"name",{value:S,configurable:!0});var v=(o,S)=>()=>(S||o((S={exports:{}}).exports,S),S.exports);var Q=v((pe,k)=>{k.exports={number:"NUMBER",string:"TEXT",date:"DATE",timestamp:"TIMESTAMP",binary:"BINARY",boolean:"BIT",document:"LONGTEXT",array:"LONGTEXT",objectId:"VARCHAR(24)",default:"CHAR"}});var w=v((ye,Z)=>{Z.exports={TINYINT:{capacity:1},SMALLINT:{capacity:2},MEDIUMINT:{capacity:3},INT:{capacity:4},INTEGER:{capacity:4},BIGINT:{capacity:8},INT1:{capacity:1},INT2:{capacity:2},INT3:{capacity:3},INT4:{capacity:4},INT8:{capacity:8},FLOAT:{capacity:4,mode:"floating"},DOUBLE:{capacity:8,mode:"floating"},"DOUBLE PRECISION":{capacity:8,mode:"floating"},REAL:{capacity:8,mode:"floating"},DECIMAL:{capacity:16,mode:"decimal"},DEC:{capacity:16,mode:"decimal"},NUMERIC:{capacity:16,mode:"decimal"},FIXED:{capacity:16,mode:"decimal"},NUMBER:{capacity:16,mode:"decimal"},CHAR:{size:1},VARCHAR:{mode:"varying"},TINYTEXT:{size:255,mode:"text"},TEXT:{size:65535,mode:"text"},MEDIUMTEXT:{size:16777215,mode:"text"},LONGTEXT:{size:4294967295,mode:"text"},JSON:{size:4294967295,mode:"text"},BINARY:{mode:"binary"},"CHAR BYTE":{mode:"binary"},VARBINARY:{size:2147483649,mode:"binary"},TINYBLOB:{size:255,mode:"binary"},BLOB:{size:65535,mode:"binary"},MEDIUMBLOB:{size:16777215,mode:"binary"},LONGBLOB:{size:4294967295,mode:"binary"},BIT:{mode:"boolean"},DATE:{format:"YYYY-MM-DD"},TIME:{format:"hh:mm:ss.nnnnnn"},DATETIME:{format:"YYYY-MM-DD hh:mm:ss"},TIMESTAMP:{format:"YYYY-MM-DD hh:mm:ss"},YEAR:{format:"YYYY"},INET6:{mode:"ip"},ENUM:{mode:"enum"},SET:{mode:"enum"},GEOMETRY:{format:"euclidian",mode:"geospatial"},POINT:{format:"euclidian",mode:"geospatial"},LINESTRING:{format:"euclidian",mode:"geospatial"},POLYGON:{format:"euclidian",mode:"geospatial"},MULTIPOINT:{format:"euclidian",mode:"geospatial"},MULTILINESTRING:{format:"euclidian",mode:"geospatial"},MULTIPOLYGON:{format:"euclidian",mode:"geospatial"},GEOMETRYCOLLECTION:{format:"euclidian",mode:"geospatial"}}});var j=v((Re,J)=>{J.exports={createDatabase:"CREATE${orReplace} DATABASE${ifNotExist} `${name}`${dbOptions};\n\n${useDb}",createTable:"CREATE ${orReplace}${temporary}TABLE ${ifNotExist}${name} (\n	${column_definitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options}${partitions}${selectStatement};\n",createLikeTable:"CREATE ${orReplace}${temporary}TABLE ${ifNotExist}${name} LIKE ${likeTableName};\n",columnDefinition:"`${name}` ${national}${type}${signed}${primary_key}${unique_key}${default}${autoIncrement}${zeroFill}${not_null}${invisible}${compressed}${charset}${collate}${comment}",checkConstraint:"CONSTRAINT ${name}CHECK (${expression})",createForeignKeyConstraint:"CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})",createKeyConstraint:"${constraintName}${keyType}${columns}${using}${blockSize}${comment}${ignore}",createForeignKey:"ALTER TABLE ${foreignTable} ADD CONSTRAINT `${name}` FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey});",index:"CREATE ${indexType}INDEX ${ifNotExist}${name}${indexCategory}\n	ON ${table} ( ${keys} )${indexOptions};\n",createView:"CREATE ${orReplace}${algorithm}${sqlSecurity}VIEW ${ifNotExist}${name} AS ${selectStatement}${checkOption};\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",createFunction:"CREATE ${orReplace}${aggregate}FUNCTION ${ifNotExist}${name}\n	(${parameters})\n	RETURNS ${type}\n	${characteristics}\n${body}${delimiter}\n",createProcedure:"CREATE ${orReplace}PROCEDURE ${name} (${parameters})\n	${characteristics}\n${body}${delimiter}\n",alterView:"ALTER VIEW ${name}${algorithm}${sqlSecurity} AS ${selectStatement}"}});var te=v((de,ee)=>{ee.exports=(o,S)=>{let M=a((e,n)=>`${e}(${n})`,"addLength"),u=a((e,n,E)=>o.isNumber(E)?`${e}(${n},${E})`:`${e}(${n})`,"addScalePrecision"),_=a((e,n)=>`${e}(${n})`,"addPrecision"),C=a(e=>["CHAR","VARCHAR","BINARY","CHAR BYTE","VARBINARY","BLOB"].includes(e),"canHaveLength"),O=a(e=>["TINYINT","SMALLINT","MEDIUMINT","INT","INTEGER","BIGINT","INT1","INT2","INT3","INT4","INT8","FLOAT","DOUBLE","REAL","DECIMAL","DEC","NUMERIC","FIXED","NUMBER","DOUBLE PRECISION","BIT"].includes(e),"isNumeric"),f=a(e=>O(e),"canHavePrecision"),B=a(e=>["TIME","DATETIME","TIMESTAMP"].includes(e),"canHaveMicrosecondPrecision"),U=a(e=>["DECIMAL","FLOAT","DOUBLE","DEC","FIXED","NUMERIC","NUMBER","DOUBLE PRECISION","REAL"].includes(e),"canHaveScale"),m=a((e,n)=>C(e)&&o.isNumber(n.length)?M(e,n.length):f(e)&&U(e)&&o.isNumber(n.precision)?u(e,n.precision,n.scale):f(e)&&o.isNumber(n.precision)?_(e,n.precision):B(e)&&o.isNumber(n.microSecPrecision)?_(e,n.microSecPrecision):["ENUM","SET"].includes(e)&&!o.isEmpty(n.enum)?`${e}('${n.enum.join("', '")}')`:e,"decorateType"),T=a(e=>["CHAR","VARCHAR","TEXT","TINYTEXT","MEDIUMTEXT","LONGTEXT"].includes(o.toUpper(e)),"isString"),I=a(e=>["TIME","DATE","DATETIME","TIMESTAMP"].includes(e),"isDateTime"),$=a(e=>o.trim(e).replace(/(\')+/g,"'$1"),"escapeQuotes");return{decorateType:m,decorateDefault:a((e,n)=>{let E=["current_timestamp","null"];return(T(e)||I(e))&&!E.includes(o.toLower(n))?S($(n)):n},"decorateDefault"),canBeNational:a(e=>["CHAR","VARCHAR"].includes(e),"canBeNational"),isNumeric:O,getSign:a((e,n)=>O(e)&&n===!1?" UNSIGNED":"","getSign")}}});var ne=v((Ce,re)=>{re.exports=(o,S)=>{let M={ENGINE:"ENGINE",AUTO_INCREMENT:"AUTO_INCREMENT",AVG_ROW_LENGTH:"AVG_ROW_LENGTH",CHECKSUM:"CHECKSUM",DATA_DIRECTORY:"DATA DIRECTORY",DELAY_KEY_WRITE:"DELAY_KEY_WRITE",INDEX_DIRECTORY:"INDEX DIRECTORY",ENCRYPTED:"ENCRYPTED",ENCRYPTION_KEY_ID:"ENCRYPTION_KEY_ID",IETF_QUOTES:"IETF_QUOTES",INSERT_METHOD:"INSERT_METHOD",UNION:"UNION",KEY_BLOCK_SIZE:"KEY_BLOCK_SIZE",MIN_ROWS:"MIN_ROWS",MAX_ROWS:"MAX_ROWS",PACK_KEYS:"PACK_KEYS",PAGE_CHECKSUM:"PAGE_CHECKSUM",PAGE_COMPRESSED:"PAGE_COMPRESSED",PAGE_COMPRESSION_LEVEL:"PAGE_COMPRESSION_LEVEL",ROW_FORMAT:"ROW_FORMAT",SEQUENCE:"SEQUENCE",STATS_AUTO_RECALC:"STATS_AUTO_RECALC",STATS_PERSISTENT:"STATS_PERSISTENT",TRANSACTIONAL:"TRANSACTIONAL",WITH_SYSTEM_VERSIONING:"WITH SYSTEM VERSIONING"},u={MyISAM:["AUTO_INCREMENT","AVG_ROW_LENGTH","CHECKSUM","DATA_DIRECTORY","DELAY_KEY_WRITE","INDEX_DIRECTORY","KEY_BLOCK_SIZE","PACK_KEYS","ROW_FORMAT","WITH_SYSTEM_VERSIONING"],InnoDB:["AUTO_INCREMENT","DATA_DIRECTORY","INDEX_DIRECTORY","ENCRYPTED","ENCRYPTION_KEY_ID","KEY_BLOCK_SIZE","PACK_KEYS","PAGE_COMPRESSED","PAGE_COMPRESSION_LEVEL","ROW_FORMAT","SEQUENCE","STATS_AUTO_RECALC","STATS_PERSISTENT","WITH_SYSTEM_VERSIONING"],CSV:["IETF_QUOTES","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],MERGE:["INSERT_METHOD","UNION","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],Aria:["AUTO_INCREMENT","AVG_ROW_LENGTH","CHECKSUM","DATA_DIRECTORY","DELAY_KEY_WRITE","INDEX_DIRECTORY","PAGE_CHECKSUM","ROW_FORMAT","KEY_BLOCK_SIZE","PACK_KEYS","TRANSACTIONAL","WITH_SYSTEM_VERSIONING"],Memory:["AUTO_INCREMENT","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"],Archive:["AUTO_INCREMENT","KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"]},_=a((e,n)=>n?`\`${n}\`.\`${e}\``:`\`${e}\``,"getTableName"),C=a((e,n)=>{if(["ROW_FORMAT","INSERT_METHOD"].includes(e))return n?o.toUpper(n):void 0;if(e==="UNION")return n;if(["YES","NO","DEFAULT"].includes(o.toUpper(n)))return o.toUpper(n);if(typeof n=="number")return n;if(!isNaN(+n)&&n)return+n;if(typeof n=="string"&&n)return S(n);if(typeof n=="boolean")return n?"YES":"NO"},"getOptionValue"),O=a((e="")=>e.replace(/(?<!\\)('|"|`)/gi,"\\$1").replace(/\n/gi,"\\n"),"encodeStringLiteral"),f=a((e={})=>{let n=[],E=e.ENGINE;return e.defaultCharSet||(e.characterSet&&n.push(`CHARSET=${e.characterSet}`),e.collation&&n.push(`COLLATE=${e.collation}`)),E&&n.push(`ENGINE = ${E}`),e.description&&n.push(`COMMENT = '${O(e.description)}'`),(u[E]||["KEY_BLOCK_SIZE","PACK_KEYS","WITH_SYSTEM_VERSIONING"]).forEach(R=>{if(R==="WITH_SYSTEM_VERSIONING")return e[R]?n.push(M[R]):void 0;let x=C(R,e[R]);if(x===void 0)return;let h=`${M[R]} = ${x}`;n.push(h)}),n.length?" "+n.join(`,
	`):""},"getTableOptions"),B=a(e=>e?"LINEAR ":"","addLinear"),U=a(e=>{if(e.partitionType==="SYSTEM_TIME"){let n=!isNaN(e.interval)&&e.interval?` INTERVAL ${e.interval}`:"";return n&&e.time_unit&&(n+=` ${e.time_unit}`),`SYSTEM_TIME${n}`}return`${B(e.LINEAR)}${e.partitionType}(${o.trim(e.partitioning_expression)})`},"getPartitionBy"),m=a(e=>e.subpartitionType?`SUBPARTITION BY ${B(e.SUBLINEAR)}${e.subpartitionType}(${o.trim(e.subpartitioning_expression)})`:"","getSubPartitionBy"),T=a(e=>{if(!Array.isArray(e.partition_definitions))return"";let n=e.partition_definitions.filter(({partitionDefinition:E})=>E).map(E=>{let N=E.subpartitionDefinition;return N?E.partitionDefinition+" "+S(N,"(",")"):E.partitionDefinition}).join(`,
		`);return n?S(`
		`+n+`
	`,"(",")"):""},"getPartitionDefinitions"),I=a((e={})=>{if(!e.partitionType)return"";let n=`PARTITION BY ${U(e)}`,E=e.partitions?`PARTITIONS ${e.partitions}`:"",N=m(e),R=e.subpartitions?`SUBPARTITIONS ${e.subpartitions}`:"",x=T(e),h=[n,E,N,R,x].filter(Boolean);return h.length?`
	`+h.join(`
	`):""},"getPartitions"),$=a(e=>e?e.alias?`\`${e.name}\` as \`${e.alias}\``:`\`${e.name}\``:"","getKeyWithAlias"),A=a(e=>Array.isArray(e)?e.reduce((n,E)=>{if(!E.tableName)return n.columns.push($(E)),n;let N=`\`${E.tableName}\``;return n.tables.includes(N)||n.tables.push(N),n.columns.push({statement:`${N}.${$(E)}`,isActivated:E.isActivated}),n},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),L=a(e=>{let n=[];return e.language&&n.push("LANGUAGE SQL"),e.deterministic&&n.push(e.deterministic),e.sqlSecurity&&n.push(`SQL SECURITY ${e.sqlSecurity}`),e.comment&&n.push(`COMMENT ${S(i(e.comment))}`),n},"getCharacteristics"),i=a((e="")=>e.replace(/(')/gi,"'$1").replace(/\n/gi,"\\n"),"escapeQuotes");return{getTableName:_,getTableOptions:f,getPartitions:I,getViewData:A,getCharacteristics:L,escapeQuotes:i}}});var ae=v((ge,ie)=>{ie.exports=({_:o,commentIfDeactivated:S,checkAllKeysDeactivated:M,divideIntoActivatedAndDeactivated:u,assignTemplates:_,escapeQuotes:C})=>({generateConstraintsString:a((m,T)=>{var L,i;let I=S(((m==null?void 0:m.deactivatedItems)||[]).join(`,
	`),{isActivated:!T,isPartOfLine:!0}),$=(L=m==null?void 0:m.activatedItems)!=null&&L.length?`,
	`+m.activatedItems.join(`,
	`):"",A=(i=m==null?void 0:m.deactivatedItems)!=null&&i.length?`
	`+I:"";return $+A},"generateConstraintsString"),foreignKeysToString:a(m=>{if(Array.isArray(m)){let T=m.filter(A=>o.get(A,"isActivated",!0)).map(A=>`\`${o.trim(A.name)}\``),I=m.filter(A=>!o.get(A,"isActivated",!0)).map(A=>`\`${o.trim(A.name)}\``),$=I.length?S(I,{isActivated:!1,isPartOfLine:!0}):"";return T.join(", ")+$}return m},"foreignKeysToString"),foreignActiveKeysToString:a(m=>m.map(T=>o.trim(T.name)).join(", "),"foreignActiveKeysToString"),createKeyConstraint:a((m,T)=>I=>{var x;let $=a(({name:h,order:V})=>`\`${h}\` ${V}`.trim(),"columnMapToString"),A=M(I.columns),L=u(I.columns,$),i=(x=L==null?void 0:L.deactivatedItems)!=null&&x.length?S(L.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"",e=!A&&T?" ("+L.activatedItems.join(", ")+i+")":" ("+I.columns.map($).join(", ")+")",n=I.category?` USING ${I.category}`:"",E=I.ignore?" IGNORED":"",N=I.comment?` COMMENT '${C(I.comment)}'`:"",R=I.blockSize?` KEY_BLOCK_SIZE=${I.blockSize}`:"";return{statement:_(m.createKeyConstraint,{constraintName:I.name?`CONSTRAINT \`${o.trim(I.name)}\` `:"",keyType:I.keyType,blockSize:R,columns:e,comment:N,ignore:E,using:n}),isActivated:!A}},"createKeyConstraint")})});var oe=v((fe,se)=>{se.exports=(o,S)=>{let M=a((i,e)=>Object.entries(i.properties).map(e),"mapProperties"),u=a(i=>i.compositeUniqueKey?!1:!!i.unique,"isUniqueKey"),_=a(i=>u(i)&&o.isEmpty(i.uniqueKeyOptions),"isInlineUnique"),C=a(i=>i.compositeUniqueKey||i.compositePrimaryKey?!1:!!i.primaryKey,"isPrimaryKey"),O=a(i=>C(i)&&o.isEmpty(i.primaryKeyOptions),"isInlinePrimaryKey"),f=a(i=>o.toLower(i)==="asc"?"ASC":o.toLower(i)==="desc"?"DESC":"","getOrder"),B=a((i,e,n)=>S({keyType:"UNIQUE",name:i.constraintName,columns:[{name:e,order:f(i.order),isActivated:n}],category:i.indexCategory,ignore:i.indexIgnore,comment:i.indexComment,blockSize:i.indexBlockSize}),"hydrateUniqueOptions"),U=a((i,e,n)=>S({keyType:"PRIMARY KEY",name:i.constraintName,columns:[{name:e,order:f(i.order),isActivated:n}],category:i.indexCategory,ignore:i.indexIgnore,comment:i.indexComment,blockSize:i.indexBlockSize}),"hydratePrimaryKeyOptions"),m=a((i,e)=>Object.keys(e).find(n=>e[n].GUID===i),"findName"),T=a((i,e)=>o.get(Object.values(e).find(n=>n.GUID===i),"isActivated",!0),"checkIfActivated"),I=a((i,e)=>i.map(n=>({name:m(n.keyId,e.properties),order:n.type==="descending"?"DESC":"ASC",isActivated:T(n.keyId,e.properties)})),"getKeys"),$=a(i=>Array.isArray(i.primaryKey)?i.primaryKey.filter(e=>!o.isEmpty(e.compositePrimaryKey)).map(e=>({...U(e),columns:I(e.compositePrimaryKey,i)})):[],"getCompositePrimaryKeys"),A=a(i=>Array.isArray(i.uniqueKey)?i.uniqueKey.filter(e=>!o.isEmpty(e.compositeUniqueKey)).map(e=>({...B(e),columns:I(e.compositeUniqueKey,i)})):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:a(({jsonSchema:i})=>{if(!i.properties)return[];let e=M(i,([E,N])=>{if(C(N)){if(o.isEmpty(N.primaryKeyOptions))return}else return;return U(N.primaryKeyOptions,E,N.isActivated)}).filter(Boolean),n=o.flatten(M(i,([E,N])=>{if(u(N)){if(o.isEmpty(N.uniqueKeyOptions)||!Array.isArray(N.uniqueKeyOptions))return[]}else return[];return N.uniqueKeyOptions.map(R=>B(R,E,N.isActivated))})).filter(Boolean);return[...e,...$(i),...n,...A(i)]},"getTableKeyConstraints"),isInlineUnique:_,isInlinePrimaryKey:O}}});var ue=Q(),ce=w(),P=j();module.exports=(o,S,M)=>{let u=M.require("lodash"),{tab:_,commentIfDeactivated:C,checkAllKeysDeactivated:O,divideIntoActivatedAndDeactivated:f,hasType:B,wrap:U,clean:m}=M.require("@hackolade/ddl-fe-utils").general,{assignTemplates:T}=M.require("@hackolade/ddl-fe-utils"),{decorateDefault:I,decorateType:$,canBeNational:A,getSign:L}=te()(u,U),{getTableName:i,getTableOptions:e,getPartitions:n,getViewData:E,getCharacteristics:N,escapeQuotes:R}=ne()(u,U),{generateConstraintsString:x,foreignKeysToString:h,foreignActiveKeysToString:V,createKeyConstraint:Ee}=ae()({_:u,commentIfDeactivated:C,checkAllKeysDeactivated:O,divideIntoActivatedAndDeactivated:f,assignTemplates:T,escapeQuotes:R}),q=oe()(u,m);return{createDatabase({databaseName:t,orReplace:r,ifNotExist:l,collation:c,characterSet:s,comments:p,udfs:g,procedures:K,useDb:d=!0}){let y="";y+=s?_(`
CHARACTER SET = '${s}'`):"",y+=c?_(`
COLLATE = '${c}'`):"",y+=p?_(`
COMMENT = '${R(p)}'`):"";let G=T(P.createDatabase,{name:t,orReplace:r&&!l?" OR REPLACE":"",ifNotExist:l?" IF NOT EXISTS":"",dbOptions:y,useDb:d?`USE \`${t}\`;
`:""}),b=g.map(Y=>this.createUdf(t,Y)),D=K.map(Y=>this.createProcedure(t,Y));return[G,...b,...D].join(`
`)},createTable({name:t,columns:r,dbData:l,temporary:c,orReplace:s,ifNotExist:p,likeTableName:g,selectStatement:K,options:d,partitioning:y,checkConstraints:G,foreignKeyConstraints:b,keyConstraints:D},Y){let H=i(t,l.databaseName),F=s?"OR REPLACE ":"",X=c?"TEMPORARY ":"",z=p?"IF NOT EXISTS ":"";if(g)return T(P.createLikeTable,{name:H,likeTableName:i(g,l.databaseName),orReplace:F,temporary:X,ifNotExist:z});let le=f(D.map(Ee(P,Y)),W=>W.statement),me=x(le,Y),Te=f(b,W=>W.statement),Ie=x(Te,Y);return T(P.createTable,{name:H,column_definitions:r.join(`,
	`),selectStatement:K?` ${K}`:"",orReplace:F,temporary:X,ifNotExist:z,options:e(d),partitions:n(y),checkConstraints:G.length?`,
	`+G.join(`,
	`):"",foreignKeyConstraints:Ie,keyConstraints:me})},convertColumnDefinition(t){let r=u.toUpper(t.type),l=t.nullable?"":" NOT NULL",c=t.primaryKey?" PRIMARY KEY":"",s=t.unique?" UNIQUE":"",p=t.zerofill?" ZEROFILL":"",g=t.autoIncrement?" AUTO_INCREMENT":"",K=t.invisible?" INVISIBLE":"",d=t.national&&A(r)?"NATIONAL ":"",y=t.comment?` COMMENT='${R(t.comment)}'`:"",G=r!=="JSON"&&t.charset?` CHARSET ${t.charset}`:"",b=r!=="JSON"&&t.charset&&t.collation?` COLLATE ${t.collation}`:"",D=u.isUndefined(t.default)?"":" DEFAULT "+I(r,t.default),Y=t.compressionMethod?` COMPRESSED=${t.compressionMethod}`:"",H=L(r,t.signed);return C(T(P.columnDefinition,{name:t.name,type:$(r,t),not_null:l,primary_key:c,unique_key:s,default:D,autoIncrement:g,compressed:Y,signed:H,zeroFill:p,invisible:K,comment:y,national:d,charset:G,collate:b}),{isActivated:t.isActivated})},createIndex(t,r,l,c=!0){if(u.isEmpty(r.indxKey)||!r.indxName)return"";let s=O(r.indxKey||[]),p=r.isActivated===!1||!c||s,g=r.indexType?`${u.toUpper(r.indexType)} `:"",K=r.ifNotExist?"IF NOT EXISTS ":"",d=U(r.indxName||"","`","`"),y=i(t,l.databaseName),G=r.indexCategory?` USING ${r.indexCategory}`:"",b=[],D=f(r.indxKey||[],F=>`\`${F.name}\`${F.type==="DESC"?" DESC":""}`),Y=D.deactivatedItems.length?C(D.deactivatedItems.join(", "),{isActivated:p,isPartOfLine:!0}):"";u.toLower(r.waitNoWait)==="wait"&&r.waitValue&&b.push(`WAIT ${r.waitValue}`),u.toLower(r.waitNoWait)==="nowait"&&b.push("NOWAIT"),r.indexComment&&b.push(`COMMENT '${R(r.indexComment)}'`),r.indexLock?b.push(`LOCK ${r.indexLock}`):r.indexAlgorithm&&b.push(`ALGORITHM ${r.indexAlgorithm}`);let H=T(P.index,{keys:D.activatedItems.join(", ")+(p&&Y&&D.activatedItems.length?", "+Y:Y),indexOptions:b.length?`
	`+b.join(`
	`):"",name:d,table:y,indexType:g,ifNotExist:K,indexCategory:G});return p?C(H,{isActivated:!1}):H},createCheckConstraint(t){return T(P.checkConstraint,{name:t.name?`${U(t.name,"`","`")} `:"",expression:u.trim(t.expression).replace(/^\(([\s\S]*)\)$/,"$1")})},createForeignKeyConstraint({name:t,foreignKey:r,primaryTable:l,primaryKey:c,primaryTableActivated:s,foreignTableActivated:p},g){let K=O(c),d=O(r),y=!K&&!d&&s&&p;return{statement:T(P.createForeignKeyConstraint,{primaryTable:i(l,g.databaseName),name:t,foreignKey:y?h(r):V(r),primaryKey:y?h(c):V(c)}),isActivated:y}},createForeignKey({name:t,foreignTable:r,foreignKey:l,primaryTable:c,primaryKey:s,primaryTableActivated:p,foreignTableActivated:g},K){let d=O(s),y=O(l);return{statement:T(P.createForeignKey,{primaryTable:i(c,K.databaseName),foreignTable:i(r,K.databaseName),name:t,foreignKey:h(l),primaryKey:h(s)}),isActivated:!d&&!y&&p&&g}},createView(t,r,l){let{deactivatedWholeStatement:c,selectStatement:s}=this.viewSelectStatement(t,l),p=t.algorithm&&t.algorithm!=="UNDEFINED"?`ALGORITHM ${t.algorithm} `:"";return C(T(P.createView,{name:i(t.name,r.databaseName),orReplace:t.orReplace?"OR REPLACE ":"",ifNotExist:t.ifNotExist?"IF NOT EXISTS ":"",sqlSecurity:t.sqlSecurity?`SQL SECURITY ${t.sqlSecurity} `:"",checkOption:t.checkOption?`
WITH ${t.checkOption} CHECK OPTION`:"",selectStatement:s,algorithm:p}),{isActivated:!c})},createViewIndex(t,r,l,c){return""},createUdt(t,r){return""},getDefaultType(t){return ue[t]},getTypesDescriptors(){return ce},hasType(t){return B(ce,t)},hydrateColumn({columnDefinition:t,jsonSchema:r,dbData:l}){return{name:t.name,type:t.type,primaryKey:q.isInlinePrimaryKey(r),unique:q.isInlineUnique(r),nullable:t.nullable,default:t.default,comment:t.description||r.refDescription||r.description,isActivated:t.isActivated,length:t.enum||t.length,scale:t.scale,precision:t.precision,national:r.national,autoIncrement:r.autoincrement,zerofill:r.zerofill,invisible:r.invisible,compressionMethod:r.compressed?r.compression_method:"",enum:r.enum,synonym:r.synonym,signed:r.zerofill||r.signed,microSecPrecision:r.microSecPrecision,charset:r.characterSet,collation:r.collation}},hydrateIndex(t,r){return t},hydrateViewIndex(t){return{}},hydrateCheckConstraint(t){return{name:t.chkConstrName,expression:t.constrExpression}},hydrateDatabase(t,r){return{databaseName:t.name,orReplace:t.orReplace,ifNotExist:t.ifNotExist,characterSet:t.characterSet,collation:t.collation,comments:t.description,udfs:((r==null?void 0:r.udfs)||[]).map(this.hydrateUdf),procedures:((r==null?void 0:r.procedures)||[]).map(this.hydrateProcedure)}},hydrateTable({tableData:t,entityData:r,jsonSchema:l}){let c=r[0],s=u.get(t,`relatedSchemas[${c.like}]`,"");return{...t,keyConstraints:q.getTableKeyConstraints({jsonSchema:l}),temporary:c.temporary,orReplace:c.orReplace,ifNotExist:!c.orReplace&&c.ifNotExist,likeTableName:(s==null?void 0:s.code)||(s==null?void 0:s.collectionName),selectStatement:u.trim(c.selectStatement),options:{...c.tableOptions,description:c.description},partitioning:c.partitioning}},hydrateViewColumn(t){return{name:t.name,tableName:t.entityName,alias:t.alias,isActivated:t.isActivated}},hydrateView({viewData:t,entityData:r,relatedSchemas:l,relatedContainers:c}){let s=r[0];return{name:t.name,tableName:t.tableName,keys:t.keys,orReplace:s.orReplace,ifNotExist:s.ifNotExist,selectStatement:s.selectStatement,sqlSecurity:s.SQL_SECURITY,algorithm:s.algorithm,checkOption:s.withCheckOption?s.checkTestingScope:""}},commentIfDeactivated(t,r,l){return t},hydrateUdf(t){return{name:t.name,delimiter:t.functionDelimiter,orReplace:t.functionOrReplace,aggregate:t.functionAggregate,ifNotExist:t.functionIfNotExist,parameters:t.functionArguments,type:t.functionReturnType,characteristics:{sqlSecurity:t.functionSqlSecurity,language:t.functionLanguage,contains:t.functionContains,deterministic:t.functionDeterministic,comment:t.functionDescription},body:t.functionBody}},hydrateProcedure(t){return{orReplace:t.orReplace,delimiter:t.delimiter,name:t.name,parameters:t.inputArgs,body:t.body,characteristics:{comment:t.comments,contains:t.contains,language:t.language,deterministic:t.deterministic,sqlSecurity:t.securityMode}}},createUdf(t,r){let l=N(r.characteristics),c=r.delimiter?`DELIMITER ${r.delimiter}
`:"",s=r.delimiter?`DELIMITER ;
`:"";return c+T(P.createFunction,{name:i(r.name,t),orReplace:r.orReplace?"OR REPLACE ":"",ifNotExist:r.ifNotExist?"IF NOT EXISTS ":"",aggregate:r.aggregate?"AGGREGATE ":"",characteristics:l.join(`
	`),type:r.type,parameters:r.parameters,body:r.body,delimiter:r.delimiter||";"})+s},createProcedure(t,r){let l=N(r.characteristics),c=r.delimiter?`DELIMITER ${r.delimiter}
`:"",s=r.delimiter?`DELIMITER ;
`:"";return c+T(P.createProcedure,{name:i(r.name,t),orReplace:r.orReplace?"OR REPLACE ":"",parameters:r.parameters,characteristics:l.join(`
	`),body:r.body,delimiter:r.delimiter||";"})+s},dropIndex(t,r,l){let c=i(t,r.databaseName),s=l.name;return`ALTER TABLE ${c} DROP INDEX IF EXISTS \`${s}\`;`},viewSelectStatement(t,r=!0){let c=O(t.keys||[])||!r,{columns:s,tables:p}=E(t.keys),g=s.map(d=>d.statement).join(`,
		`);if(!c){let d=f(s,G=>G.statement),y=d.deactivatedItems.length?C(d.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";g=d.activatedItems.join(`,
		`)+y}let K=u.trim(t.selectStatement)?u.trim(_(t.selectStatement)):T(P.viewSelectStatement,{tableName:p.join(", "),keys:g});return{deactivatedWholeStatement:c,selectStatement:K}}}};
